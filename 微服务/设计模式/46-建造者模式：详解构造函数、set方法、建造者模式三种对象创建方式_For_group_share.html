<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>46-建造者模式：详解构造函数、set方法、建造者模式三种对象创建方式</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>46-建造者模式：详解构造函数、set方法、建造者模式三种对象创建方式</h1>
<p>上两节课中，我们学习了工厂模式，讲了工厂模式的应用场景，并带你实现了一个简单的DI容器。今天，我们再来学习另外一个比较常用的创建型设计模式，<strong>Builder模式</strong>，中文翻译为<strong>建造者模式</strong>或者<strong>构建者模式</strong>，也有人叫它<strong>生成器模式</strong>。</p><p>实际上，建造者模式的原理和代码实现非常简单，掌握起来并不难，难点在于应用场景。比如，你有没有考虑过这样几个问题：直接使用构造函数或者配合set方法就能创建对象，为什么还需要建造者模式来创建呢？建造者模式和工厂模式都可以创建对象，那它们两个的区别在哪里呢？</p><p>话不多说，带着上面两个问题，让我们开始今天的学习吧！</p><h2>为什么需要建造者模式？</h2><p>在平时的开发中，创建一个对象最常用的方式是，使用new关键字调用类的构造函数来完成。我的问题是，什么情况下这种方式就不适用了，就需要采用建造者模式来创建对象呢？你可以先思考一下，下面我通过一个例子来带你看一下。</p><p>假设有这样一道设计面试题：我们需要定义一个资源池配置类ResourcePoolConfig。这里的资源池，你可以简单理解为线程池、连接池、对象池等。在这个资源池配置类中，有以下几个成员变量，也就是可配置项。现在，请你编写代码实现这个ResourcePoolConfig类。</p><!-- [[[read_end]]] --><p><img src="https://static001.geekbang.org/resource/image/21/59/21f970b7c0d6b5afa6aa09ca14f55059.jpg" alt=""></p><p>只要你稍微有点开发经验，那实现这样一个类对你来说并不是件难事。最常见、最容易想到的实现思路如下代码所示。因为maxTotal、maxIdle、minIdle不是必填变量，所以在创建ResourcePoolConfig对象的时候，我们通过往构造函数中，给这几个参数传递null值，来表示使用默认值。</p><pre><code>public class ResourcePoolConfig {
  private static final int DEFAULT_MAX_TOTAL = 8;
  private static final int DEFAULT_MAX_IDLE = 8;
  private static final int DEFAULT_MIN_IDLE = 0;

  private String name;
  private int maxTotal = DEFAULT_MAX_TOTAL;
  private int maxIdle = DEFAULT_MAX_IDLE;
  private int minIdle = DEFAULT_MIN_IDLE;

  public ResourcePoolConfig(String name, Integer maxTotal, Integer maxIdle, Integer minIdle) {
    if (StringUtils.isBlank(name)) {
      throw new IllegalArgumentException(&quot;name should not be empty.&quot;);
    }
    this.name = name;

    if (maxTotal != null) {
      if (maxTotal &lt;= 0) {
        throw new IllegalArgumentException(&quot;maxTotal should be positive.&quot;);
      }
      this.maxTotal = maxTotal;
    }

    if (maxIdle != null) {
      if (maxIdle &lt; 0) {
        throw new IllegalArgumentException(&quot;maxIdle should not be negative.&quot;);
      }
      this.maxIdle = maxIdle;
    }

    if (minIdle != null) {
      if (minIdle &lt; 0) {
        throw new IllegalArgumentException(&quot;minIdle should not be negative.&quot;);
      }
      this.minIdle = minIdle;
    }
  }
  //...省略getter方法...
}
</code></pre><p>现在，ResourcePoolConfig只有4个可配置项，对应到构造函数中，也只有4个参数，参数的个数不多。但是，如果可配置项逐渐增多，变成了8个、10个，甚至更多。如果继续沿用现在的设计思路，那构造函数的参数列表会变得很长，代码在可读性和易用性上都会变差。在使用构造函数的时候，我们就容易搞错各参数的顺序，传递进错误的参数值，导致非常隐蔽的bug。不仅如此，函数参数太多，写出来的代码，可读性也非常差。</p><pre><code>// 参数太多，导致可读性差、参数可能传递错误
ResourcePoolConfig config = new ResourcePoolConfig(&quot;dbconnectionpool&quot;, 16, null, 8, null, false , true, 10, 20，false， true);
</code></pre><p>解决这个问题的办法你应该也已经想到了，那就是用set()函数来给成员变量赋值，以替代冗长的构造函数。我们直接看代码，具体如下所示。其中，配置项name是必填的，所以我们把它放到构造函数中设置，强制创建类对象的时候就要填写。其他配置项maxTotal、maxIdle、minIdle都不是必填的，所以我们通过set()函数来设置，让使用者自主选择填写或者不填写。</p><pre><code>public class ResourcePoolConfig {
  private static final int DEFAULT_MAX_TOTAL = 8;
  private static final int DEFAULT_MAX_IDLE = 8;
  private static final int DEFAULT_MIN_IDLE = 0;

  private String name;
  private int maxTotal = DEFAULT_MAX_TOTAL;
  private int maxIdle = DEFAULT_MAX_IDLE;
  private int minIdle = DEFAULT_MIN_IDLE;
  
  public ResourcePoolConfig(String name) {
    if (StringUtils.isBlank(name)) {
      throw new IllegalArgumentException(&quot;name should not be empty.&quot;);
    }
    this.name = name;
  }

  public void setMaxTotal(int maxTotal) {
    if (maxTotal &lt;= 0) {
      throw new IllegalArgumentException(&quot;maxTotal should be positive.&quot;);
    }
    this.maxTotal = maxTotal;
  }

  public void setMaxIdle(int maxIdle) {
    if (maxIdle &lt; 0) {
      throw new IllegalArgumentException(&quot;maxIdle should not be negative.&quot;);
    }
    this.maxIdle = maxIdle;
  }

  public void setMinIdle(int minIdle) {
    if (minIdle &lt; 0) {
      throw new IllegalArgumentException(&quot;minIdle should not be negative.&quot;);
    }
    this.minIdle = minIdle;
  }
  //...省略getter方法...
}
</code></pre><p>接下来，我们来看新的ResourcePoolConfig类该如何使用。我写了一个示例代码，如下所示。没有了冗长的函数调用和参数列表，代码在可读性和易用性上提高了很多。</p><pre><code>// ResourcePoolConfig使用举例
ResourcePoolConfig config = new ResourcePoolConfig(&quot;dbconnectionpool&quot;);
config.setMaxTotal(16);
config.setMaxIdle(8);
</code></pre><p>至此，我们仍然没有用到建造者模式，通过构造函数设置必填项，通过set()方法设置可选配置项，就能实现我们的设计需求。如果我们把问题的难度再加大点，比如，还需要解决下面这三个问题，那现在的设计思路就不能满足了。</p><ul>
<li>我们刚刚讲到，name是必填的，所以，我们把它放到构造函数中，强制创建对象的时候就设置。如果必填的配置项有很多，把这些必填配置项都放到构造函数中设置，那构造函数就又会出现参数列表很长的问题。如果我们把必填项也通过set()方法设置，那校验这些必填项是否已经填写的逻辑就无处安放了。</li>
<li>除此之外，假设配置项之间有一定的依赖关系，比如，如果用户设置了maxTotal、maxIdle、minIdle其中一个，就必须显式地设置另外两个；或者配置项之间有一定的约束条件，比如，maxIdle和minIdle要小于等于maxTotal。如果我们继续使用现在的设计思路，那这些配置项之间的依赖关系或者约束条件的校验逻辑就无处安放了。</li>
<li>如果我们希望ResourcePoolConfig类对象是不可变对象，也就是说，对象在创建好之后，就不能再修改内部的属性值。要实现这个功能，我们就不能在ResourcePoolConfig类中暴露set()方法。</li>
</ul><p>为了解决这些问题，建造者模式就派上用场了。</p><p>我们可以把校验逻辑放置到Builder类中，先创建建造者，并且通过set()方法设置建造者的变量值，然后在使用build()方法真正创建对象之前，做集中的校验，校验通过之后才会创建对象。除此之外，我们把ResourcePoolConfig的构造函数为了private私有权限，只能通过建造者来创建ResourcePoolConfig类对象，并且ResourcePoolConfig没有提供任何set()方法，这样创建出来的对象就是不可变对象了。</p><p>我们用建造者模式重新实现了上面的需求，具体的代码如下所示：</p><pre><code>public class ResourcePoolConfig {
  private String name;
  private int maxTotal;
  private int maxIdle;
  private int minIdle;

  private ResourcePoolConfig(Builder builder) {
    this.name = builder.name;
    this.maxTotal = builder.maxTotal;
    this.maxIdle = builder.maxIdle;
    this.minIdle = builder.minIdle;
  }
  //...省略getter方法...

  //我们将Builder类被设计成了ResourcePoolConfig的内部类。
  //我们也可以将Builder类设计成独立的非内部类ResourcePoolConfigBuilder。
  public static class Builder {
    private static final int DEFAULT_MAX_TOTAL = 8;
    private static final int DEFAULT_MAX_IDLE = 8;
    private static final int DEFAULT_MIN_IDLE = 0;

    private String name;
    private int maxTotal = DEFAULT_MAX_TOTAL;
    private int maxIdle = DEFAULT_MAX_IDLE;
    private int minIdle = DEFAULT_MIN_IDLE;

    public ResourcePoolConfig build() {
      // 校验逻辑放到这里来做，包括必填项校验、依赖关系校验、约束条件校验等
      if (StringUtils.isBlank(name)) {
        throw new IllegalArgumentException(&quot;...&quot;);
      }
      if (maxIdle &gt; maxTotal) {
        throw new IllegalArgumentException(&quot;...&quot;);
      }
      if (minIdle &gt; maxTotal || minIdle &gt; maxIdle) {
        throw new IllegalArgumentException(&quot;...&quot;);
      }

      return new ResourcePoolConfig(this);
    }

    public Builder setName(String name) {
      if (StringUtils.isBlank(name)) {
        throw new IllegalArgumentException(&quot;...&quot;);
      }
      this.name = name;
      return this;
    }

    public Builder setMaxTotal(int maxTotal) {
      if (maxTotal &lt;= 0) {
        throw new IllegalArgumentException(&quot;...&quot;);
      }
      this.maxTotal = maxTotal;
      return this;
    }

    public Builder setMaxIdle(int maxIdle) {
      if (maxIdle &lt; 0) {
        throw new IllegalArgumentException(&quot;...&quot;);
      }
      this.maxIdle = maxIdle;
      return this;
    }

    public Builder setMinIdle(int minIdle) {
      if (minIdle &lt; 0) {
        throw new IllegalArgumentException(&quot;...&quot;);
      }
      this.minIdle = minIdle;
      return this;
    }
  }
}

// 这段代码会抛出IllegalArgumentException，因为minIdle&gt;maxIdle
ResourcePoolConfig config = new ResourcePoolConfig.Builder()
        .setName(&quot;dbconnectionpool&quot;)
        .setMaxTotal(16)
        .setMaxIdle(10)
        .setMinIdle(12)
        .build();
</code></pre><p></p><p>实际上，使用建造者模式创建对象，还能避免对象存在无效状态。我再举个例子解释一下。比如我们定义了一个长方形类，如果不使用建造者模式，采用先创建后set的方式，那就会导致在第一个set之后，对象处于无效状态。具体代码如下所示：</p><pre><code>Rectangle r = new Rectange(); // r is invalid
r.setWidth(2); // r is invalid
r.setHeight(3); // r is valid
</code></pre><p>为了避免这种无效状态的存在，我们就需要使用构造函数一次性初始化好所有的成员变量。如果构造函数参数过多，我们就需要考虑使用建造者模式，先设置建造者的变量，然后再一次性地创建对象，让对象一直处于有效状态。</p><p>实际上，如果我们并不是很关心对象是否有短暂的无效状态，也不是太在意对象是否是可变的。比如，对象只是用来映射数据库读出来的数据，那我们直接暴露set()方法来设置类的成员变量值是完全没问题的。而且，使用建造者模式来构建对象，代码实际上是有点重复的，ResourcePoolConfig类中的成员变量，要在Builder类中重新再定义一遍。</p><h2>与工厂模式有何区别？</h2><p>从上面的讲解中，我们可以看出，建造者模式是让建造者类来负责对象的创建工作，上一节课中讲到的工厂模式，是由工厂类来负责对象创建的工作，那它们之间有什么区别呢？</p><p>实际上，工厂模式是用来创建不同但是相关类型的对象（继承同一父类或者接口的一组子类），由给定的参数来决定创建哪种类型的对象。建造者模式是用来创建一种类型的复杂对象，通过设置不同的可选参数，“定制化”地创建不同的对象。</p><p>网上有一个经典的例子很好地解释了两者的区别。</p><p>顾客走进一家餐馆点餐，我们利用工厂模式，根据用户不同的选择，来制作不同的食物，比如披萨、汉堡、沙拉。对于披萨来说，用户又有各种配料可以定制，比如奶酪、西红柿、起司，我们通过建造者模式根据用户选择的不同配料来制作披萨。</p><p>实际上，我们也不要太学院派，非得把工厂模式、建造者模式分得那么清楚，我们需要知道的是，每个模式为什么这么设计，能解决什么问题。<strong>只有了解了这些最本质的东西，我们才能不生搬硬套，才能灵活应用，甚至可以混用各种模式创造出新的模式，来解决特定场景的问题。</strong></p><h2>重点回顾</h2><p>好了，今天的内容到此就讲完了。我们一块来总结回顾一下，你需要重点掌握的内容。</p><p>建造者模式的原理和实现比较简单，重点是掌握应用场景，避免过度使用。</p><p>如果一个类中有很多属性，为了避免构造函数的参数列表过长，影响代码的可读性和易用性，我们可以通过构造函数配合set()方法来解决。但是，如果存在下面情况中的任意一种，我们就要考虑使用建造者模式了。</p><ul>
<li>我们把类的必填属性放到构造函数中，强制创建对象的时候就设置。如果必填的属性有很多，把这些必填属性都放到构造函数中设置，那构造函数就又会出现参数列表很长的问题。如果我们把必填属性通过set()方法设置，那校验这些必填属性是否已经填写的逻辑就无处安放了。</li>
<li>如果类的属性之间有一定的依赖关系或者约束条件，我们继续使用构造函数配合set()方法的设计思路，那这些依赖关系或约束条件的校验逻辑就无处安放了。</li>
<li>如果我们希望创建不可变对象，也就是说，对象在创建好之后，就不能再修改内部的属性值，要实现这个功能，我们就不能在类中暴露set()方法。构造函数配合set()方法来设置属性值的方式就不适用了。</li>
</ul><p>除此之外，在今天的讲解中，我们还对比了工厂模式和建造者模式的区别。工厂模式是用来创建不同但是相关类型的对象（继承同一父类或者接口的一组子类），由给定的参数来决定创建哪种类型的对象。建造者模式是用来创建一种类型的复杂对象，可以通过设置不同的可选参数，“定制化”地创建不同的对象。</p><h2>课堂讨论</h2><p>在下面的ConstructorArg类中，当isRef为true的时候，arg表示String类型的refBeanId，type不需要设置；当isRef为false的时候，arg、type都需要设置。请根据这个需求，完善ConstructorArg类。</p><pre><code> public class ConstructorArg {
    private boolean isRef;
    private Class type;
    private Object arg;
    // TODO: 待完善...
  }
</code></pre><p>欢迎留言和我分享你的想法，如果有收获，你也可以把这篇文章分享给你的朋友。</p><h2>精选留言：</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            相逢是缘  2020-02-17 17:40:18
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            打卡<br>一、使用场景：<br>1）类的构造函数必填属性很多，通过set设置，没有办法校验必填属性<br>2）如果类的属性之间有一定的依赖关系，构造函数配合set方式，无法进行依赖关系和约束条件校验<br>3）需要创建不可变对象，不能暴露set方法。<br>（前提是需要传递很多的属性，如果属性很少，可以不需要建造者模式）<br>二、实现方式：<br>把构造函数定义为private，定义public static class Builder 内部类，通过Builder 类的set方法设置属性，调用build方法创建对象。<br><br>三、和工厂模式的区别：<br>1）工厂模式：创建不同的同一类型对象（集成同一个父类或是接口的一组子类），由给定的参数来创建哪种类型的对象；<br>2）建造者模式：创建一种类型的复杂对象，通过很多可设置参数，“定制化”的创建对象 [3赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            黄林晴  2020-02-17 22:12:03
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            打卡~<br>最近半年用的最多的就是Builder模式了 [2赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            webmin  2020-02-17 13:53:31
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            public class ConstructorArg {<br>    private boolean isRef;<br>    private Class type;<br>    private Object arg;<br><br>    public boolean isRef() {<br>        return isRef;<br>    }<br><br>    public Class getType() {<br>        return type;<br>    }<br><br>    public Object getArg() {<br>        return arg;<br>    }<br><br>    private ConstructorArg(Builder builder) {<br>        this.isRef = builder.isRef;<br>        this.type = builder.type;<br>        this.arg = builder.arg;<br>    }<br><br>    public static class Builder {<br>        private boolean isRef;<br>        private Class type;<br>        private Object arg;<br><br>        public ConstructorArg build() {<br>            if(isRef &amp;&amp; type != null) {<br>                throw new IllegalArgumentException(&quot;...&quot;);<br>            }<br><br>            if (!isRef &amp;&amp; type == null) {<br>                throw new IllegalArgumentException(&quot;...&quot;);<br>            }<br><br>            if (this.isRef &amp;&amp; (arg != null &amp;&amp; arg.getClass() != String.class)) {<br>                throw new IllegalArgumentException(&quot;...&quot;);<br>            }<br><br>            if (!this.isRef &amp;&amp; arg == null) {<br>                throw new IllegalArgumentException(&quot;...&quot;);<br>            }<br><br>            return new ConstructorArg(this);<br>        }<br><br>        public Builder setRef(boolean ref) {<br>            if(ref &amp;&amp; this.type != null) {<br>                throw new IllegalArgumentException(&quot;...&quot;);<br>            }<br>            this.isRef = ref;<br>            return this;<br>        }<br><br>        public Builder setType(Class type) {<br>            if (this.isRef || type == null) {<br>                throw new IllegalArgumentException(&quot;...&quot;);<br>            }<br>            this.type = type;<br>            return this;<br>        }<br><br>        public Builder setArg(Object arg) {<br>            if (this.isRef &amp;&amp; (arg != null &amp;&amp; arg.getClass() != String.class)) {<br>                throw new IllegalArgumentException(&quot;...&quot;);<br>            }<br><br>            if (!this.isRef &amp;&amp; arg == null) {<br>                throw new IllegalArgumentException(&quot;...&quot;);<br>            }<br>            this.arg = arg;<br>            return this;<br>        }<br>    }<br>} [2赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            王涛  2020-02-17 12:05:21
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            最近，在学习本专栏的过程中。<br>逐渐体会到“知其然，更知其所以然”的感觉<br> [2赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            大牛凯  2020-02-17 03:01:34
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            感觉课后思考题的arguments逻辑判断相对复杂，再加上想尝试一下建造者模式，所以抛砖引玉，给一个Python的尝试，有一个困惑是对于Python这种语言，如何避免对用户暴露在调用builder之前build方法之前初始化的ConstructorArg对象？<br><br>class ConstructorArg(object):<br>    def __init__(self, isRef):  #如何避免暴露这个实例对象？<br>        self.isRef = isRef<br>        self.type = None<br>        self.arg = None<br>    <br>    def __repr__(self):<br>        string = f&quot;isRef:  {self.isRef}\n&quot; + \<br>                 f&quot;type:   {self.type}\n&quot; + \<br>                 f&quot;arg:    {self.arg}\n&quot;<br>        return string<br><br>    class ConstructorArgBuilder(object):<br>        def __init__(self, isRef):<br>            self.constructorArg = ConstructorArg(isRef)<br><br>        def addType(self, typeObj):<br>            self.constructorArg.type = typeObj<br>            return self<br><br>        def addArg(self, argObj):<br>            self.constructorArg.arg = argObj<br>            return self<br><br>        def build(self):<br>            if self.constructorArg.isRef:<br>                if self.constructorArg.type is None:<br>                    raise Exception(&quot;type cannot be None when isRef&quot;)<br>                elif not isinstance(self.constructorArg.type, str):<br>                    raise Exception(&quot;type must be string when isRef&quot;)<br>            elif not self.constructorArg.isRef:<br>                if self.constructorArg.type is None:<br>                    raise Exception(&quot;type cannot be None when not isRef&quot;)<br>                if self.constructorArg.arg is None:<br>                    raise Exception(&quot;arg cannot be None when not isRef&quot;)<br>            return self.constructorArg [2赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            啦啦啦  2020-02-17 22:11:42
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            用php实现了一个<br>&lt;?php<br>class ResourcePoolConfig{<br>    private $maxTotal;<br>    private $maxIdle;<br>    private $minIdle;<br>    public function __construct(build $build)<br>    {<br>        $this-&gt;maxTotal = $build-&gt;maxTotal;<br>        $this-&gt;maxIdle = $build-&gt;maxIdle;<br>        $this-&gt;minIdle = $build-&gt;minIdle;<br>        echo &#39;maxTotal&#39;.$this-&gt;maxTotal;<br>        echo &#39;&lt;br &#47;&gt;&#39;;<br>        echo &#39;maxIdle&#39;.$this-&gt;maxIdle;<br>        echo &#39;&lt;br &#47;&gt;&#39;;<br>        echo &#39;minIdle&#39;.$this-&gt;minIdle;<br>        echo &#39;&lt;br &#47;&gt;&#39;;<br>    }<br>}<br><br>class Builder{<br>    public $maxTotal;<br>    public $maxIdle;<br>    public $minIdle;<br>    public function noodleValidate(){<br>        if($this-&gt;maxIdle&gt;$this-&gt;maxTotal){<br>            throw new Exception(&quot;maxIdle抛出异常&quot;);<br>        }<br>        if($this-&gt;minIdle&gt;$this-&gt;maxTotal){<br>            throw new Exception(&quot;minIdle抛出异常&quot;);<br>        }<br>    }<br><br>    public function setMaxTotal($value=20){<br>        $this-&gt;maxTotal = $value;<br>        return $this;<br>    }<br><br>    public function setMaxIdle($value=10){<br>        $this-&gt;maxIdle = $value;<br>        return $this;<br>    }<br><br>    public function setMinIdle($value=10){<br>        $this-&gt;minIdle = $value;<br>        return $this;<br>    }<br>}<br><br>$b = new Builder();<br>$b-&gt;setMaxTotal(5)-&gt;setMaxIdle()-&gt;setMinIdle()-&gt;noodleValidate();<br>new ResourcePoolConfig($b); [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            PHP是世界上最好的需要  2020-02-17 16:07:27
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            总感觉只是把校验逻辑挪到了bulder 里。没直观的感觉到builder 的有点呢。老师~ [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Ken张云忠  2020-02-17 11:41:49
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            public class ConstructorArg {<br>    private boolean isRef;<br>    private Class type;<br>    private Object arg;<br>    public ConstructorArg(ConstructorArgBuilder builder) {<br>        this.isRef = builder.isRef;<br>        this.type = builder.type;<br>        this.arg = builder.arg;<br>    }<br>    public static class ConstructorArgBuilder {<br>        private boolean isRef;<br>        private Class type;<br>        private Object arg;<br>        public ConstructorArg builder() {<br>            if (arg == null) {<br>                throw new IllegalArgumentException(&quot;arg should not be null&quot;);<br>            }<br>            if (isRef == true) {<br>                if (arg instanceof String) {<br>                    type = String.class;<br>                } else {<br>                    throw  new IllegalArgumentException(&quot;when isRef is true,arg should be String type&quot;);<br>                }<br>            } else {<br>                type = arg.getClass();<br>            }<br>            return new ConstructorArg(this);<br>        }<br>        public ConstructorArgBuilder(boolean isRef) {<br>            this.isRef = isRef;<br>        }<br>        public ConstructorArgBuilder setArg(Object arg) {<br>            this.arg = arg;<br>            return this;<br>        }<br>    }<br>}<br> &#47;&#47; use case<br>ConstructorArg constructorArg = new ConstructorArgBuilder(true).setArg(0).builder();<br>ConstructorArg constructorArg1 = new ConstructorArgBuilder(false).setArg(1).builder(); [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Algo  2020-02-17 11:34:42
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            package com.acacia.leetcode.huahua.questions;<br><br>public class ConstructorArg {<br>    private boolean isRef;<br>    private Class type;<br>    private Object arg;<br><br>    private ConstructorArg(Builder builder){<br>        this.isRef = builder.isRef;<br>        this.type = builder.type;<br>        this.arg = builder.arg;<br>    }<br><br>    public static class Builder{<br>        private final static Class TYPE_STRING = String.class;<br>        private final static Object ARG_STRING = &quot;String&quot;;<br><br>        private boolean isRef;<br>        private Class type;<br>        private Object arg;<br><br>        public ConstructorArg build(){<br>            if (isRef == true){<br>                this.type = TYPE_STRING;<br>                this.arg = ARG_STRING;<br>                return new ConstructorArg(this);<br>            }else {<br>                return new ConstructorArg(this);<br>            }<br>        }<br><br>        public Builder setRef(boolean ref) {<br>            this.isRef = ref;<br>            return this;<br>        }<br><br>        public Builder setType(Class type) {<br>&#47;&#47;            if (!type.isMemberClass()){<br>&#47;&#47;                throw new IllegalArgumentException(&quot;failed class name&quot;);<br>&#47;&#47;            }<br>            this.type = type;<br>            return this;<br>        }<br><br>        public Builder setArg(Object arg) {<br>            if (arg == null){<br>                throw new IllegalArgumentException(&quot;can not be null&quot;);<br>            }<br>            this.arg = arg;<br>            return this;<br>        }<br>    }<br><br>    public static void main(String[] args) {<br>        ConstructorArg arg = new ConstructorArg.Builder().setRef(true).build();<br>        System.out.println(arg.type);<br>        System.out.println(arg.arg);<br>        ConstructorArg arg1 = new ConstructorArg.Builder().setArg(false).setType(Integer.class).setArg(2).build();<br>        System.out.println(arg1.type);<br>        System.out.println(arg1.arg);<br>    }<br>}<br><br><br><br> [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            cricket1981  2020-02-17 10:45:21
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            public class ConstructorArg {<br><br>    private boolean isRef;<br>    private Class type;<br>    private Object arg;<br><br>    private ConstructorArg(Builder builder) {<br>        this.isRef = builder.isRef;<br>        this.type = builder.type;<br>        this.arg = builder.arg;<br>    }<br><br>    public boolean getIsRef() {<br>        return isRef;<br>    }<br><br>    public Class getType() {<br>        return type;<br>    }<br><br>    public Object getArg() {<br>        return arg;<br>    }<br><br>    public static class Builder {<br><br>        private boolean isRef;<br>        private Class type;<br>        private Object arg;<br><br>        public ConstructorArg build() {<br>            if (arg == null) {<br>                throw new IllegalArgumentException(&quot;The value of parameter `arg` should be provided.&quot;);<br>            }<br>            if (!this.isRef &amp;&amp; type == null) {<br>                throw new IllegalArgumentException(&quot;The value of parameter `type` should be provided if `isRef` == false.&quot;);<br>            }<br>            return new ConstructorArg(this);<br>        }<br><br>        public Builder setRef(boolean isRef) {<br>            this.isRef = isRef;<br>            return this;<br>        }<br><br>        public Builder setType(Class type) {<br>            this.type = type;<br>            return this;<br>        }<br><br>        public Builder setArg(Object arg) {<br>            this.arg = arg;<br>            return this;<br>        }<br>    }<br><br>}<br><br>用法：<br>ConstructorArg constructorArg1 = new ConstructorArg.Builder()<br>        .setArg(&quot;rateCounter&quot;)<br>        .setRef(true)<br>        .build();<br><br>ConstructorArg constructorArg2 = new ConstructorArg.Builder()<br>        .setArg(&quot;127.0.0.1&quot;)<br>        .setType(String.class)<br>        .setRef(false)<br>        .build(); [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            小晏子  2020-02-17 10:08:56
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            课后讨论题：<br><br> public class ConstructorArg {<br>    private boolean isRef;<br>    private Class type;<br>    private Object arg;<br>    &#47;&#47; TODO: 待完善...<br><br>    private ConstructorArg(Builder builder) {<br>        this.isRef = builder.isRef;<br>        this.type  = builder.type;<br>        this.arg   = builder.arg;<br>    }<br><br>    public static class Builder {<br>        private boolean isRef;<br>        private Class type;<br>        private Object arg;<br><br>        public ConstructorArg build() {<br>            if (!isRef) {<br>                if (type == null || arg == null){<br>                    throw new IllegalArgumentException(&quot;type and arg must be set when isRef is false&quot;)<br>                }<br>            } else {<br>                if (!(arg instanceof String)) {<br>                    throw new IllegalArgumentException(&quot;arg must be a String instance when isRef is true&quot;)<br>                }<br>            }<br>            return new ConstructorArg(this);<br>        }<br>    }<br><br>    public Builder setIsRef(boolean isRef){<br>        this.isRef = isRef;<br>        return this;<br>    }<br><br>    public Builder setType(Class type) {<br>        this.type = type;<br>        return this;<br>    }<br><br>    public Builder setObject(Object arg) {<br>        this.arg = arg;<br>        return this;<br>    }<br>  }<br><br>  &#47;&#47;use case<br>  ConstructorArg ca = ConstructorArg.Builder()<br>        .setIfRef(false)<br>        .setType(Integer)<br>        .setObject(2)<br>        .build(); [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Frank  2020-02-17 09:53:11
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            当在开发中需要创建一个具体的对象，如果必填属性很多，属性存在复杂的校验和属性之间存在依赖关系，可以使用建造者模式来避免类的构造函数参数列表过长，导致可读性差，不易使用的问题。建造者模式可以将类的构造方法私有，不提供类的setter方法，因此可以创建一个不变的对象。同时在某些场景下将属性构造好可以解决类的无效状态。<br>使用思路：把校验逻辑放置到 Builder 类中，先创建建造者，并且通过 set() 方法设置建造者的变量值，然后在使用 build() 方法真正创建对象之前，做集中的校验，校验通过之后才会创建对象。除此之外，我们把主类的构造函数为了private 私有权限，只能通过建造者来创建 类对象，并且主类没有提供任何 set() 方法，这样创建出来的对象就是不可变对象了。 [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            javaadu  2020-02-17 09:37:08
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            课堂讨论题：<br><br>&#47;**<br> * 在下面的 ConstructorArg 类中，<br> * 当 isRef 为 true 的时候，arg 表示 String 类型的 refBeanId，type 不需要设置；<br> * 当 isRef 为 false 的时候，arg、type 都需要设置<br> *<br> * @author javaadu<br> *&#47;<br>public class ConstructorArg {<br>    private boolean isRef;<br>    private Class type;<br>    private Object arg;<br><br>    private ConstructorArg(Builder builder) {<br>        this.isRef = builder.isRef;<br>        this.type = builder.type;<br>        this.arg = builder.arg;<br>    }<br><br>    public static class Builder {<br>        private boolean isRef;<br>        private Class type;<br>        private Object arg;<br><br>        public ConstructorArg build() {<br>            if (arg == null) {<br>                throw new IllegalArgumentException(&quot;arg必须设置&quot;);<br>            }<br>            if (isRef) {<br>                if (!(arg instanceof String)) {<br>                    throw new IllegalArgumentException(&quot;arg必须为String类型的对象&quot;);<br>                }<br>            } else {<br>                if (type == null) {<br>                    throw new IllegalArgumentException(&quot;arg必须设置&quot;);<br>                }<br>            }<br><br>            return new ConstructorArg(this)<br>        }<br><br>        public Builder setRef(boolean ref) {<br>            isRef = ref;<br>            return this;<br>        }<br><br>        public Builder setArg(Object arg) {<br>            this.arg = arg;<br>            return this;<br>        }<br><br>        public Builder setType(Class type) {<br>            this.type = type;<br>            return this;<br>        }<br>    }<br>} [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Jeff.Smile  2020-02-17 07:03:51
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            建造者模式核心代码:<br>ResourcePoolConfig config = new ResourcePoolConfig.Builder()<br>        .setName(&quot;dbconnectionpool&quot;)<br>        .setMaxTotal(16)<br>        .setMaxIdle(10)<br>        .setMinIdle(12)<br>        .build(); [1赞]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            朱晋君  2020-02-18 10:10:07
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            课后思考题<br>public class ConstructorArg {<br><br>    private boolean isRef;<br>    private Class type;<br>    private Object arg;<br><br>    private ConstructorArg(Builder builder){<br>        this.isRef = builder.isRef;<br>        this.type = builder.type;<br>        this.arg = builder.arg;<br>    }<br><br>    public static class Builder{<br><br>        private boolean isRef;<br>        private Class type;<br>        private Object arg;<br><br>        public Builder(boolean isRef){<br>            this.isRef = isRef;<br>        }<br><br>        public ConstructorArg build(){<br>            return new ConstructorArg(this);<br>        }<br><br>        public Builder setType(Class type) {<br>            if (!isRef &amp;&amp; null == type){<br>                throw new IllegalArgumentException(&quot;type must be not null&quot;);<br>            }<br>            this.type = type;<br>            return this;<br>        }<br><br>        public Builder setArg(Object arg) {<br>            if (isRef &amp;&amp; !(arg instanceof String)){<br>                throw new IllegalArgumentException(&quot;arg must be type of String&quot;);<br>            }<br><br>            if (!isRef &amp;&amp; null == arg){<br>                throw new IllegalArgumentException(&quot;arg must be not null&quot;);<br>            }<br>            this.arg = arg;<br>            return this;<br>        }<br>    }<br><br>    public static void main(String args[]){<br>        ConstructorArg constructorArg = new ConstructorArg.Builder(true).setArg(&quot;123&quot;).build();<br>    }<br>} 
        </div>
        
    </div>
</li>
            </ul>
</div>
</body>
</html>